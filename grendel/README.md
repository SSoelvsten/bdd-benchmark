# Grendel
This folder contains the generation of shell scripts, with which one can run the
benchmarks on the GRENDEL cluster running the SLURM queueing system at [CSCAA,
Aarhus University](http://www.cscaa.dk/). Since _Adiar_ makes use of disk, then
one needs to use the newly acquired _q48_ nodes with 3.0 GHz CPUs, 384 GB of
memory, and 3.5 TB of SSD disk available for temporary files in a _scratch/_
directory.

## Generating the .sh scripts

All shell scripts used on the cluster are generated by the Python 3 script in
`grendel_gen.py`

```bash
module load python/3.9.4
python3 grendel_gen.py
```

Alternatively, you can use the Makefile, which both includes a _build_ and a
_clean_ target.

```bash
ml load python/3.9.4 && make
```

## Running the .sh scripts

To compile all the benchmarks for the desired CPU (i.e. with the correct
instruction set), we provide the `build.sh` script that can be run on the frontend
node. From the root directory of this repository, call the builde script.

```bash
./grendel/build.sh
```

When the build is complete, then you can schedule all the generated shell files
onto nodes on the cluster. Again, from the root directory, write

```bash
for f in grendel/*-*-*-*.sh; do sbatch -p q48 $f; done
```

The `*` are the different time limits genereated. Hence, by specifying
`grendel/00-*.sh*` you can choose to only schedule the jobs with a time limit of
less than a single day.

## Checking Current Jobs

The following is Grendel's own command to see the current status of your jobs

```bash
mj
```

If you want some more control over formatting (e.g. see the names in full), then
you should instead use something like the following.

```bash
squeue --me --format "%20i | %2t | %42j | %r"
```

## Cancel all jobs

To cancel all jobs, run the following bash one-liner.

```bash
mj | tail -n +3 | while read line ; do echo $line | cut -c1-8 | xargs scancel ; done
```

## Download Output to your Local Machine

Assuming you have a copy of the repository in the `~/bdd_benchmark/` folder with
the results from the job scripts in this folder stored in `~/bdd_benchmark/out`
(default), then you can download all the data to your local machine with the
following command:

```bash
scp -r {username}@grendel.cscaa.dk:bdd-benchmark/out/ .
```
